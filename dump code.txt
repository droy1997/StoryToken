
const http = require('http');
const fs = require('fs');
const formidable = require('formidable');

http.createServer(function (req, res) {
  if (req.url == '/upload' && req.method.toLowerCase() == 'post') {
    var form = new formidable.IncomingForm();
    form.parse(req, function (err, fields, files) {
      var oldpath = files.photo.path;
      var newpath = './uploads/' + files.photo.name;
      fs.rename(oldpath, newpath, function (err) {
        if (err) throw err;
        res.write('File uploaded and saved!');
        res.end();
      });
    });
  } else {
    res.writeHead(200, {'Content-Type': 'text/html'});
    res.write('<form action="/upload" method="post" enctype="multipart/form-data">');
    res.write('<input type="file" name="photo">');
    res.write('<input type="submit" value="Upload">');
    res.write('</form>');
    return res.end();
  }
}).listen(8080);



// Get the file input element
var fileInput = document.getElementById('myFileInput');

// Get the file and its name from the file input element
var file = fileInput.files[0];
var fileName = file.name;

// Create a new XHR object
var xhr = new XMLHttpRequest();

// Set up the XHR request
xhr.open('POST', '/upload', true);
xhr.setRequestHeader('Content-Type', 'application/octet-stream');
xhr.setRequestHeader('Content-Disposition', 'attachment; filename="' + fileName + '"');

// Send the file data as the request body
xhr.send(file);




var express = require('express');
var multer = require('multer');
var path = require('path');
var app = express();

app.use(express.static('src'));
app.use(express.static('../StoryToken-contract/build/contracts'));

// Set up multer middleware to handle file uploads
var upload = multer({
  storage: multer.diskStorage({
    destination: function (req, file, callback) {
      callback(null, './uploads'); // Set destination folder for uploaded files
    },
    filename: function (req, file, callback) {
      var ext = path.extname(file.originalname);
      callback(null, file.fieldname + '-' + Date.now() + ext); // Set filename for uploaded files
    }
  })
});

// Route for handling file uploads
app.post('/upload', upload.single('file'), function (req, res) {
  console.log(req.file); // Log information about the uploaded file
  res.send('File uploaded successfully'); // Return response to the client
});

app.get('/', function (req, res) {
  res.render('index.html');
});

app.listen(3000, function () {
  console.log('StoryToken Dapp listening on port 3000!');
});







